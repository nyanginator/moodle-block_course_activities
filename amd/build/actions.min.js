define(["jquery","core/str","core/ajax","core/templates"],function(c,d,b,a){return{init:function(g){var h=c(".block_course_activities .accordion-content");var f=c(".block_course_activities .expandtoggle");c(".block_course_activities #accordion-collapse-all").on("click",function(i){c(h).removeClass("show");c(f).attr("aria-expanded","false")});c(".block_course_activities #accordion-expand-all").on("click",function(i){c(h).addClass("show");c(f).attr("aria-expanded","true")});c("form.togglecompletion").each(function(){c(this).on("click",e)});function e(t){t.preventDefault();var k=this;var v=0;var q=0;var j=null;var p=null;var m=null;var l=null;var s=c("input",this);for(var r=0;r<s.length;r++){switch(s[r].name){case"id":v=s[r].value;break;case"completionstate":q=s[r].value;j=s[r];break;case"modulename":m=s[r];break;case"sesskey":l=s[r].value;break}}p=c("button .icon",k);allimages=c('form.togglecompletion input[name="id"][value="'+v+'"]').parent().find("button .icon");allbuttontextspans=c('form.togglecompletion input[name="id"][value="'+v+'"]').parent().find("button .mac-btn-text");allstates=c('form.togglecompletion input[name="id"][value="'+v+'"]').parent().find('input[name="completionstate"]');var o=c('<div class="ajaxworking"></div>');c(k).append(o);c.ajax({url:g.wwwroot+"/course/togglecompletion.php",data:{id:v,completionstate:q,fromajax:1,sesskey:l},type:"post",success:function(x,i,w){u(x)},error:function(x,i,w){n(i)}});function u(z){c("#completion_dynamic_change").val(1);if(z!="OK"){alert("An error occurred when attempting to save your tick mark.\n\n("+z.responseText+")")}else{var A=c(j).val();var y=c(m).val();var i;var x=c(p).closest("button");if(A==1){var w=d.get_string("completion-alt-manual-y","completion",y);i="i/completion-manual-y";c(allstates).each(function(){c(this).val(0)})}else{var w=d.get_string("completion-alt-manual-n","completion",y);i="i/completion-manual-n";c(allstates).each(function(){c(this).val(1)})}c.when(w).done(function(B){var C=B;c(x).attr("title",C);a.renderPix(i,"core",C).then(function(D){a.replaceNode(c(allimages),D,"")})});c(allbuttontextspans).each(function(){var C=this;var B=d.get_string((A==1?"completed":"notcompleted"),"completion");c.when(B).done(function(D){var E=D;c(C).text(E)})})}c(o).remove()}function n(i){alert("An error occurred when attempting to save your tick mark ("+i+").");c(o).remove()}}}}});